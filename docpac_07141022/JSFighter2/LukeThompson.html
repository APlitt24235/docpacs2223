<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSFighter2</title>
</head>
<body>

</body>
<script>
    var allfighters = 0
    var fighternames1 = ["Luke", "Alex", "Beckham", "David", "Riley"]
    var fighternames2 = ["Logan D", "Logan C", "Mac", "Wesley", "Gavin"]
    var fighternames = ["Luke", "Alex", "Logan D", "Logan C", "David", "Beckham", "Mac", "Wesley", "Gavin", "Riley"]
    var fighterlist = []
    const numberofteams = 2
    var gameround = 0
    var gameturn = 0

    class Fighter {
        constructor(id, name, team){
            this.id = allfighters
            this.hp = (Math.round(Math.random() * 10) + 20) * 10
            this.hp_max = this.hp
            this.atk = Math.round(Math.random() * 10) + 10
            this.spd = Math.round(Math.random() * 5) + 5
            this.name = name
            this.ready = true
            this.team = team
            this.img = document.createElement('img')
            this.img.src = ""
        }
        attack(target){
            fighterlist.forEach((fighters) => {
                if (fighters.hp > 0){
                    if (fighterlist.indexOf(fighters) == 0){
                        fighters.img.src = "img/crashr_idle.png"
                    }
                    else if (fighterlist.indexOf(fighters) == 1){
                        fighters.img.src = "img/saml_idle.png"
                    }
                }
            })
            let counter = 0
            do {
                counter++
                var randomFighter = fighterlist[Math.round(Math.random() * 1)]
                if (counter > fighterlist.length){
                    if (document.getElementById("output") != null){
                        document.getElementById("output").innerHTML = "There is no target."
                    }
                    break
                    return
                }
            }
            while (randomFighter.hp > 0 && randomFighter.team != this.team)
            var targetDiv = document.getElementById("Fighter " + target.id).children
            target.hp = target.hp - (this.atk * (Math.round(Math.random() * 15) - 5))
            if (target.hp < 0){
                target.hp = 0
                document.getElementById("Fighter " + target.id).className = "dead"
                if (target.id == 0){
                    for (let i = 0; i < targetDiv.length; i++) {
                        var currentChild = targetDiv[i]
                        if (currentChild.classname == "fighterGFX") {
                            currentChild.src = "img/crashr_ko.png"
                            currentChild.style.filter = "grayscale(1)"
                            target.img.src = "img/crashr_ko.png"
                        }
                    }
                    
                }
                else if (target.id == 1){
                    target.img.src = "img/saml_ko.png"
                    for (let i = 0; i < targetDiv.length; i++) {
                        var currentChild = targetDiv[i]
                        if (currentChild.classname == "fighterGFX") {
                            currentChild.src = "img/saml_ko.png"
                            currentChild.style.filter = "grayscale(1)"
                            target.img.src = "img/saml_ko.png"
                        }
                    }
                }
            }
            if (this.id == 0){
                this.img.src = "img/crashr_attack.png"
            }
            else if (this.id == 1){
                this.img.src = "img/saml_attack.png"
            }
            if (target.id == 0){
                target.img.src = "img/crashr_hit.png"
            }
            else if (target.id == 1){
                target.img.src = "img/saml_hit.png"
            }
            document.getElementsByClassName("statsBox").innerHTML = target.name + "'s ATK: " + target.atk + "<br>" + target.name + "'s HP: " + target.hp
            document.getElementById("output").innerHTML = this.name + " just attacked " + target.name + "!"
            document.getElementById("Fighter " + this.id).className = ""
            this.ready = false
            gameturn = gameturn + 1
            gameLoop()
        };
    };

    for (i = 0; i < 2; i++){
        var fighter = new Fighter();
        if ((i % 2) == 0) {
            fighter.name = fighternames1[Math.round(Math.random() * 5)]
        }
        else {
            fighter.name = fighternames2[Math.round(Math.random() * 5)]
        }
        fighter.team = i % numberofteams;
        allfighters++;
        fighterlist.push(fighter);
    };

    for (i = 0; i < numberofteams; i++){
        var teamDiv = document.createElement("div");
        teamDiv.id = "team " + i;
        teamDiv.className = "teamBox";
        teamDiv.style.display = "inline-block";
        document.body.appendChild(teamDiv);
    };

    for (fighters of fighterlist){
        var fighterIndex = fighterlist.indexOf(fighters);
        var fighterDiv = document.createElement("div");
        fighterDiv.id = "Fighter " + fighters.id;
        fighterDiv.className = "fighterBox";
        fighterDiv.style.display = "inline-block";
        fighterDiv.style.margin = 5 + "px"
        var fighterImg = document.createElement("img");
        fighterImg.className = "fighterGFX";
        fighterDiv.appendChild(fighterImg);
        if (fighters.team == 0){
            fighters.img.src = "img/crashr_idle.png";
        }
        else if (fighters.team == 1){
            fighters.img.src = "img/saml_idle.png";
        };
        fighterImg.src = fighters.img.src;
        var fighterStats = document.createElement("div");
        fighterStats.className = "statsBox";
        fighterDiv.appendChild(fighterStats);
        fighterStats.innerHTML = fighters.name + "'s ATK: " + fighters.atk + "<br>" + fighters.name + "'s HP: " + fighters.hp;
        var fighterControls = document.createElement("div");
        fighterControls.className = "controlsBox";
        var attackButton = document.createElement("button");
        attackButton.disabled = true;
        attackButton.id = "Attack";
        attackButton.innerHTML = "Attack";
        if (fighterIndex == 0){
            attackButton.onclick = function(){
                fighterlist[0].attack(fighterlist[1]);
            };
        }
        else if (fighterIndex == 1){
            attackButton.onclick = function(){
                fighterlist[1].attack(fighterlist[0])
            };
        };
        fighterDiv.appendChild(attackButton);
        document.body.appendChild(fighterDiv);
    };

    var outputDiv = document.createElement("div");
    outputDiv.id = "output";
    document.body.appendChild(outputDiv);

    function gameLoop(){
        if (gameturn >= fighterlist.length){
            gameturn = 0;
            gameround++;
            for (fighters in fighterlist){
                if (fighters.hp > 0){
                    fighters.ready = true;
                };
            };
        };
        fighterlist.sort(function(a, b){return b.spd - a.spd});
        fighterlist.forEach((fighters) => {
            if (fighterlist.indexOf(fighters) == gameturn && fighters.ready == true && fighters.hp > 0){
                document.getElementById("Fighter " + fighters.id).className = "active";
                document.getElementById("Attack").disabled = false;
                document.getElementById("output").innerHTML = "It's " + fighters.name + "'s turn!";
            }
            else{
                gameturn++;
                //gameLoop();
            };
        });
    };

    gameLoop();
</script>
</html>
