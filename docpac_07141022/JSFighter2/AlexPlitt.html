<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSFighter2</title>
</head>
<body>

</body>
<script>
    var allFighters = 0
    var fighterNames = ["Luke", "Alex", "Logan D", "Logan C", "David", "Beckham", "Mac", "Wesley", "Gavin", "Riley"]
    var fighterList = []
    const numberOfTeams = 2
    var gameRound = 0
    var gameTurn = 0

    class Fighter {
        constructor(id, name, team){
            this.id = allFighters
            this.hp = 20
            this.hp_max = 20
            this.atk = 2
            this.spd = 3
            this.name = name
            this.ready = true
            this.team = team
            this.img = document.createElement('img')
            this.img.src = ""
        }
        attack(target){
            fighterList.forEach((fighters) => {
                if (fighters.hp > 0){
                    if (fighterList.indexOf(fighters) == 0){
                        fighters.img.src = "img/crashr_idle.png"
                    }
                    else if (fighterList.indexOf(fighters) == 1){
                        fighters.img.src = "img/saml_idle.png"
                    }
                }
            })
            let counter = 0
            do {
                counter++
                var randomFighter = fighterList[Math.floor(Math.random() * 1)]
                if (counter > fighterList.length){
                    if (document.getElementById("output") != null){
                        document.getElementById("output").innerHTML = "There is no target."
                    }
                    break
                    return
                }
            }
            while (randomFighter.hp > 0 && randomFighter.team != this.team)
            target.hp = target.hp - (this.atk * (Math.floor(Math.random() * 3) + 1))
            if (target.hp < 0){
                target.hp = 0
                document.getElementById("Fighter " + target.id).className = "dead"
                if (target.id == 0){
                    target.img.src = "img/crashr_ko.png"
                }
                else if (target.id == 1){
                    target.img.src = "img/saml_ko.png"
                }
            }
            if (this.id == 0){
                this.img.src = "img/crashr_attack.png"
            }
            else if (this.id == 1){
                this.img.src = "img/saml_attack.png"
            }
            if (target.id == 0){
                target.img.src = "img/crashr_hit.png"
            }
            else if (target.id == 1){
                target.img.src = "img/saml_hit.png"
            }
            document.getElementsByClassName("statsBox").innerHTML = target.name + "'s ATK: " + target.atk + "<br>" + target.name + "'s HP: " + target.hp
            document.getElementById("output").innerHTML = this.name + " just attacked " + target.name + "!"
            document.getElementById("Fighter " + this.id).className = ""
            this.ready = false
            gameTurn = gameTurn + 1
            gameLoop()
        };
    };

    for (i = 0; i < 2; i++){
        var fighter = new Fighter();
        fighter.name = fighterNames[Math.floor(Math.random() * 5)];
        fighter.team = i % numberOfTeams;
        allFighters++;
        fighterList.push(fighter);
    };

    for (i = 0; i < numberOfTeams; i++){
        var teamDiv = document.createElement("div");
        teamDiv.id = "team " + i;
        teamDiv.className = "teamBox";
        teamDiv.style.display = "inline-block";
        document.body.appendChild(teamDiv);
    };

    for (fighters of fighterList){
        var fighterIndex = fighterList.indexOf(fighters);
        var fighterDiv = document.createElement("div");
        fighterDiv.id = "Fighter " + fighters.id;
        fighterDiv.className = "fighterBox";
        fighterDiv.style.display = "inline-block";
        fighterDiv.style.margin = 5 + "px"
        var fighterImg = document.createElement("img");
        fighterImg.className = "fighterGFX";
        fighterDiv.appendChild(fighterImg);
        if (fighters.team == 0){
            fighters.img.src = "img/crashr_idle.png";
        }
        else if (fighters.team == 1){
            fighters.img.src = "img/saml_idle.png";
        };
        fighterImg.src = fighters.img.src;
        var fighterStats = document.createElement("div");
        fighterStats.className = "statsBox";
        fighterDiv.appendChild(fighterStats);
        fighterStats.innerHTML = fighters.name + "'s ATK: " + fighters.atk + "<br>" + fighters.name + "'s HP: " + fighters.hp;
        var fighterControls = document.createElement("div");
        fighterControls.className = "controlsBox";
        var attackButton = document.createElement("button");
        attackButton.disabled = true;
        attackButton.id = "Attack";
        attackButton.innerHTML = "Attack";
        if (fighterIndex == 0){
            attackButton.onclick = function(){
                fighterList[0].attack(fighterList[1]);
            };
        }
        else if (fighterIndex == 1){
            attackButton.onclick = function(){
                fighterList[1].attack(fighterList[0])
            };
        };
        fighterDiv.appendChild(attackButton);
        document.body.appendChild(fighterDiv);
    };

    var outputDiv = document.createElement("div");
    outputDiv.id = "output";
    document.body.appendChild(outputDiv);

    function gameLoop(){
        if (gameTurn >= fighterList.length){
            gameTurn = 0;
            gameRound++;
            for (fighters in fighterList){
                if (fighters.hp > 0){
                    fighters.ready = true;
                };
            };
        };
        fighterList.sort(function(a, b){return b.spd - a.spd});
        fighterList.forEach((fighters) => {
            if (fighterList.indexOf(fighters) == gameTurn && fighters.ready == true && fighters.hp > 0){
                document.getElementById("Fighter " + fighters.id).className = "active";
                document.getElementById("Attack").disabled = false;
                document.getElementById("output").innerHTML = "It's " + fighters.name + "'s turn!";
            }
            else{
                gameTurn++;
                //gameLoop();
            };
        });
    };

    gameLoop();
</script>
</html>
