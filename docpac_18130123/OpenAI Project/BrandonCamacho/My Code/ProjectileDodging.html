<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projectile Dodging Game</title>
</head>
<canvas id="game-canvas"></canvas>
<style>
    #game-canvas {
        border: 5px solid white;
        background-color: black;
    }

    body {
        overflow: hidden;
        background-image: linear-gradient(180deg,
                hsl(0deg 0% 0%) 0%,
                hsl(0deg 100% 7%) 47%,
                hsl(358deg 79% 15%) 67%,
                hsl(358deg 86% 25%) 81%,
                hsl(0deg 88% 34%) 91%,
                hsl(0deg 84% 34%) 100%);
        text-align: center;
    }
</style>

<body>
    <script>
        // setup canvas
        var canvas = document.getElementById("game-canvas");
        var ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth / 1.5;
        canvas.height = window.innerHeight - 25;

        // timer variables
        var startTime;
        var gameOver = false;

        // player object
        var player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 20,
            height: 20,
            speed: 8,
            upPressed: false,
            downPressed: false,
            leftPressed: false,
            rightPressed: false,
            color: "blue"
        };

        // array to store projectiles
        var projectiles = [];

        // function to create projectiles
        function createProjectile() {
            var projectileSize = Math.floor(Math.random() * 15) + 10;
            var projectile = {
                x: Math.random() * canvas.width,
                y: 0,
                width: projectileSize,
                height: projectileSize,
                color: "red"
            };
            projectiles.push(projectile);
        }

        // update projectiles position
        function updateProjectiles() {
            for (var i = 0; i < projectiles.length; i++) {
                projectiles[i].y += 5; // move projectiles down by 5 pixels
                if (projectiles[i].y > canvas.height) {
                    projectiles.splice(i, 1); // remove projectiles when they go off screen
                }
            }
        }

        // check for collision between player and projectiles
        function checkCollision() {
            for (var i = 0; i < projectiles.length; i++) {
                if (
                    player.x < projectiles[i].x + projectiles[i].width &&
                    player.x + player.width > projectiles[i].x &&
                    player.y < projectiles[i].y + projectiles[i].height &&
                    player.y + player.height > projectiles[i].y
                ) {
                    gameOver = true;
                }
            }
        }

        // move player based on user input
        function inputs() {
            if (player.upPressed) {
                if (player.y > 0) {
                    player.y = player.y - player.speed;
                }
            }
            if (player.downPressed) {
                if (player.y + player.height < canvas.height) {
                    player.y = player.y + player.speed;
                }
            }
            if (player.leftPressed) {
                if (player.x > 0) {
                    player.x = player.x - player.speed;
                }
            }
            if (player.rightPressed) {
                if (player.x + player.width < canvas.width) {
                    player.x = player.x + player.speed;
                }
            }
        }

        document.body.addEventListener("keydown", keyDown);
        document.body.addEventListener("keyup", keyUp);

        function keyDown(event) {
            //up
            if (event.keyCode == 38) {
                player.upPressed = true;
            }

            //down
            if (event.keyCode == 40) {
                player.downPressed = true;
            }
            //left
            if (event.keyCode == 37) {
                player.leftPressed = true;
            }

            //right
            if (event.keyCode == 39) {
                player.rightPressed = true;
            }
        }

        function keyUp(event) {
            //up
            if (event.keyCode == 38) {
                player.upPressed = false;
            }

            //down
            if (event.keyCode == 40) {
                player.downPressed = false;
            }
            //left
            if (event.keyCode == 37) {
                player.leftPressed = false;
            }

            //right
            if (event.keyCode == 39) {
                player.rightPressed = false;
            }
        }

        // main game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas

            // check if start time is not set
            if (!startTime) {
                startTime = Date.now();
            }
            if (!gameOver) {
                // calculate elapsed time
                var elapsedTime = Date.now() - startTime;
                var seconds = Math.floor(elapsedTime / 1000);
            }

            createProjectile(); // creates projectiles
            updateProjectiles(); // update projectiles position
            checkCollision(); // check for collision
            inputs(); // check for inputs

            if (gameOver) {
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText("Game Over!", canvas.width / 2 - 100, canvas.height / 2);
                ctx.fillText("Time: " + seconds + "s", canvas.width / 2 - 100, canvas.height / 2 + 50);
                return;
            } else {
                // draw elapsed time
                ctx.fillStyle = "white";
                ctx.font = "20px Arial";
                ctx.fillText("Time: " + seconds + "s", canvas.width - 120, 30);
            }
            // draw player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // draw projectiles
            for (var i = 0; i < projectiles.length; i++) {
                ctx.fillStyle = projectiles[i].color;
                ctx.fillRect(projectiles[i].x, projectiles[i].y, projectiles[i].width, projectiles[i].height);
            }
            requestAnimationFrame(gameLoop);
        }

        // Controller Support
        var direction = 0
        window.addEventListener('gamepadconnected', (event) => {
            // Update Controller
            const update = () => {
                //Only read the first controller
                const cont = navigator.getGamepads()[0];
                if (cont.axes[1] >= 0.3) { //Down
                    player.y = player.y + player.speed;
                }
                if (cont.axes[1] <= -0.3) { //Up
                    player.y = player.y - player.speed;
                }
                if (cont.axes[0] >= 0.3) { //Right
                    player.x = player.x + player.speed;
                }
                if (cont.axes[0] <= -0.3) { //Left
                    player.x = player.x - player.speed;
                }
                //This will loop the update every "animation frame"
                requestAnimationFrame(update);
            }; //End Update Controller
            //Kick off the loop
            update();
        });

        // Starts the Game
        gameLoop();
    </script>
</body>

</html>